!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ytSearch=e()}(function(){return function r(l,u,o){function s(t,e){if(!u[t]){if(!l[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(c)return c(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var a=u[t]={exports:{}};l[t][0].call(a.exports,function(e){return s(l[t][1][e]||e)},a,a.exports,r,l,u,o)}return u[t].exports}for(var c="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(s,e,t){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ee=s("cheerio"),c=s("dasu");s("async.parallellimit");c.follow=!1,c.debug=!1;var te=s("jsonpath"),v="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html) (yt-search; https://www.npmjs.com/package/yt-search)",d=s("url"),i={};Object.keys(process.env).forEach(function(e){var t=process.env[e];if("0"==t||"false"==t||!t)return i[e]=!1;i[e]=t});var p=i.debug;function ie(){p&&console.log.apply(this,arguments)}var n,y=s("querystring"),g=s("human-time"),ne={YT:"https://youtube.com",SEARCH_MOBILE:"https://m.youtube.com/results",SEARCH_DESKTOP:"https://www.youtube.com/results"};function a(e,t){if(!t)return new Promise(function(i,n){a(e,function(e,t){return e?n(e):void i(t)})});var i="string"==typeof e?{query:e}:e;if(i.userAgent&&(v=i.userAgent),i.search=i.query||i.search,i.original_search=i.search,i.videoId)return function(e,a){var t;ie("fn: getVideoMetaData"),"string"==typeof e&&(t=e);"object"===r(e)&&(t=e.videoId);var i="https://www.youtube.com/watch?hl=en&gl=US&v="+t,n=d.parse(i);n.headers={"user-agent":v,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},n.headers["user-agent"]="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.1.1 Safari/605.1.15",c.req(n,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){ie("_parseVideoInitialData");var i=_(j(/ytInitialData.*=\s*{/,e=S(e)),"{","}");if(!i)return t("could not find inital data in the html document");var n=_(j(/ytInitialPlayerResponse.*=\s*{/,e),"{","}");if(!n)return t("could not find inital player data in the html document");var a=JSON.parse(i),r=JSON.parse(n),l=te.value(a,"$..currentVideoEndpoint..videoId");if(!l)return t("video unavailable");if("ERROR"===te.value(r,"$..status")||"Video unavailable"===te.value(r,"$..reason"))return t("video unavailable");var u=te.value(a,"$..videoPrimaryInfoRenderer..title..text")||te.value(a,"$..videoPrimaryInfoRenderer..title..simpleText")||te.value(a,"$..videoPrimaryRenderer..title..text")||te.value(a,"$..videoPrimaryRenderer..title..simpleText")||te.value(a,"$..title..text")||te.value(a,"$..title..simpleText"),o=te.query(a,"$..description..text").join("")||te.query(r,"$..description..simpleText").join("")||te.query(r,"$..microformat..description..simpleText").join("")||te.query(r,"$..videoDetails..shortDescription").join(""),s=te.value(a,"$..owner..title..text")||te.value(a,"$..owner..title..simpleText"),c=te.value(a,"$..owner..navigationEndpoint..url")||te.value(a,"$..owner..title..url"),v="https://i.ytimg.com/vi/"+l+"/hqdefault.jpg",d=re(function(e){var t="",i=Math.floor(e/36e5),n=Math.floor(e/6e4)%60,a=Math.floor(e/1e3)%60;i&&(t+=i+":");n&&(t+=n+":");String(a).length<2&&(t+="0");return t+=a}(1e3*Number(te.value(r,"$..videoDetails..lengthSeconds")))),p=te.value(a,"$..sentimentBar..tooltip").split(/[,.]/).join("").split(/\D+/),f=(Number(p[0]),Number(p[1]),te.value(a,"$..uploadDate")||te.value(a,"$..dateText..simpleText")),h=f&&g(new Date(f))||"",m={title:u,description:o,url:ne.YT+"/watch?v="+l,videoId:l,seconds:Number(d.seconds),timestamp:d.timestamp,duration:d,views:Number(te.value(r,"$..videoDetails..viewCount")),genre:(te.value(r,"$..category")||"").toLowerCase(),uploadDate:ae(f),ago:h,image:v,thumbnail:v,author:{name:s,url:ne.YT+c}};t(null,m)}(i,a)}catch(e){a(e)}}})}(i.videoId,t);if(i.listId)return function(e,a){var t;ie("fn: getPlaylistMetaData"),"string"==typeof e&&(t=e);"object"===r(e)&&(t=e.listId||e.playlistId);var i="https://www.youtube.com/playlist?hl=en&gl=US&list="+t,n=d.parse(i);n.headers={"user-agent":v,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"},c.req(n,function(e,t,i){if(e)a(e);else{if(200!==t.status)return a("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{!function(e,t){ie("fn: parsePlaylistBody");var i=(e=S(e)).match(/ytInitialData.*=\s*({.*});/)[1];if(!i)throw new Error("failed to parse ytInitialData json data");var n=JSON.parse(i),a=te.value(n,"$..microformat..urlCanonical").split("=")[1],r=te.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[1].simpleText").match(/\d+/),l=te.query(n,"$..contents..tabs[0]..contents[0]..contents[0]..contents")[0],u=[];l.forEach(function(e){var t=e,i={title:te.value(t,"$..title..simpleText")||te.value(t,"$..title..text")||te.query(item,"$..title..text").join(""),videoId:te.value(t,"$..videoId"),listId:a,thumbnail:te.value(t,"$..thumbnail..thumbnails[0]..url").split("?")[0],author:{name:te.value(t,"$..shortBylineText..runs[0]..text"),url:"https://youtube.com"+te.value(t,"$..shortBylineText..runs[0]..url")}};u.push(i)});var o={title:te.value(n,"$..microformat..title"),listId:a,url:"https://youtube.com/playlist?list="+a,views:Number(r),date:function(e){ie("fn: _parsePlaylistLastUpdateTime");for(var t=e.trim().split(/[\s.-]+/),i=0;i<t.length;i++){var n=t.slice(i),a=n.join(" "),r=n.reverse().join(" "),l=new Date(a),u=new Date(r);if("Invalid Date"!==l.toString())return ae(l);if("Invalid Date"!==u.toString())return ae(u)}return""}(te.value(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..simpleText")||te.query(n,"$..sidebar.playlistSidebarRenderer.items[0]..stats[2]..text").join("")||""),image:u[0].thumbnail,thumbnail:u[0].thumbnail,videos:u,author:{name:te.value(n,"$..videoOwner..title..runs[0]..text"),url:"https://youtube.com"+te.value(n,"$..videoOwner..navigationEndpoint..url")}};t&&t(null,o)}(i,a)}catch(e){a(e)}}})}(i.listId,t);if(!i.search)return t(Error("yt-search: no query given"));!function f(h,m){var e=y.escape(h.search).split(/\s+/);var t=h.hl||"en";var i=h.gl||"US";var n=h.category||"";var a=Number(h.pageStart)||1;var r=Number(h.pageEnd)||Number(h.pages)||1;a<=0&&(a=1)<=r&&(r+=1);Number.isNaN(r)&&m("error: pageEnd must be a number");h.pageStart=a;h.pageEnd=r;h.currentPage=h.currentPage||a;var l="?";l+="search_query="+e.join("+");-1===l.indexOf("&hl=")&&(l+="&hl="+t);-1===l.indexOf("&gl=")&&(l+="&gl="+i);n&&(l+="&category="+n);h.sp&&(l+="&sp="+h.sp);var u=ne.SEARCH_DESKTOP+l;var o=d.parse(u);o.headers={"user-agent":v,accept:"text/html","accept-encoding":"gzip","accept-language":"en-US"};ie(o);ie("getting results: "+h.currentPage);c.req(o,function(e,t,i){if(e)m(e);else{if(200!==t.status)return m("http status: "+t.status);var n;p&&(n=s("fs"),s("path"),n.writeFileSync("dasu.response",t.responseText,"utf8"));try{I(i,function(e,t){if(e)return m(e);var i=t,n=i.filter(x),a=i.filter($),r=i.filter(b),l=i.filter(T),u=i.filter(w);h._data=h._data||{},h._data.videos=h._data.videos||[],h._data.playlists=h._data.playlists||[],h._data.channels=h._data.channels||[],h._data.live=h._data.live||[],h._data.all=h._data.all||[],n.forEach(function(e){h._data.videos.push(e)}),a.forEach(function(e){h._data.playlists.push(e)}),r.forEach(function(e){h._data.channels.push(e)}),l.forEach(function(e){h._data.live.push(e)}),u.forEach(function(e){h._data.all.push(e)}),h.currentPage++;var o,s,c,v,d,p=h.currentPage<=h.pageEnd;p&&t._sp?(h.sp=t._sp,setTimeout(function(){f(h,m)},2500)):(o=h._data.videos.filter(x),s=h._data.playlists.filter($),c=h._data.channels.filter(b),v=h._data.live.filter(T),d=h._data.all.slice(w),m(null,{all:d,videos:o,live:v,playlists:s,lists:s,accounts:c,channels:c}))})}catch(e){m(e)}}})}(i,t)}function x(e,t,i){if("video"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function $(e,t,i){if("list"!==e.type)return!1;var n=e.listId;return i.findIndex(function(e){return n===e.listId})===t}function b(e,t,i){if("channel"!==e.type)return!1;var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function T(e,t,i){if("live"!==e.type)return!1;var n=e.videoId;return i.findIndex(function(e){return n===e.videoId})===t}function w(e,t,i){switch(e.type){case"video":case"list":case"channel":case"live":break;default:return!1}var n=e.url;return i.findIndex(function(e){return n===e.url})===t}function I(e,t){var n=/{.*}/,i=ee.load(e),a=i("div#initial-data").html()||"";if(!(a=n.exec(a)||""))for(var r=i("script"),l=0;l<r.length;l++){i(r[l]).html().split("\n").forEach(function(e){for(var t;0<=(t=e.indexOf("ytInitialData"));){e=e.slice(t+"ytInitialData".length);var i=n.exec(e);i&&i.length>a.length&&(a=i)}})}if(!a)return t("could not find inital data in the html document");var u=[],o=[],s=JSON.parse(a[0]),c=te.query(s,"$..itemSectionRenderer..contents.*");ie("items.length: "+c.length);for(var v=0;v<c.length;v++){var d=c[v],p=void 0,f="unknown",h=d.compactPlaylistRenderer||d.playlistRenderer,m=d.compactChannelRenderer||d.channelRenderer,y=d.compactVideoRenderer||d.videoRenderer,g=h&&te.value(d,"$..playlistId"),x=m&&te.value(d,"$..channelId"),$=y&&te.value(d,"$..videoId"),b=te.query(d,"$..viewCountText..text").join(""),T="UPCOMING"===te.query(d,"$..thumbnailOverlayTimeStatusRenderer..style").join("").trim();$&&(f="video"),x&&(f="channel"),g&&(f="list"),(0<=b.indexOf("watching")||"LIVE"===te.query(d,"$..thumbnailOverlayTimeStatusRenderer..text").join("").trim()||T)&&(f="live");try{switch(f){case"video":var w=le(te.value(d,"$..thumbnail..url"))||le(te.value(d,"$..thumbnails..url"))||le(te.value(d,"$..thumbnails")),I=te.value(d,"$..title..text")||te.value(d,"$..title..simpleText"),S=te.value(d,"$..shortBylineText..text")||te.value(d,"$..longBylineText..text"),j=te.value(d,"$..shortBylineText..url")||te.value(d,"$..longBylineText..url"),_=te.value(d,"$..publishedTimeText..text")||te.value(d,"$..publishedTimeText..simpleText"),q=te.value(d,"$..viewCountText..text")||te.value(d,"$..viewCountText..simpleText")||"0",D=Number(q.split(/\s+/)[0].split(/[,.]/).join("").trim()),E=re(te.value(d,"$..lengthText..text")||te.value(d,"$..lengthText..simpleText")||"0:00"),N=te.query(d,"$..description..text").join("")||te.query(d,"$..descriptionSnippet..text").join(""),p={type:"video",videoId:$,url:ne.YT+"/watch?v="+$,title:I.trim(),description:N,image:w,thumbnail:w,seconds:Number(E.seconds),timestamp:E.timestamp,duration:E,ago:_,views:Number(D),author:{name:S,url:ne.YT+j}};break;case"list":var C=le(te.value(d,"$..thumbnail..url"))||le(te.value(d,"$..thumbnails..url"))||le(te.value(d,"$..thumbnails")),O=te.value(d,"$..title..text")||te.value(d,"$..title..simpleText"),R=te.value(d,"$..shortBylineText..text")||te.value(d,"$..longBylineText..text")||te.value(d,"$..shortBylineText..simpleText")||te.value(d,"$..longBylineText..simpleTextn")||"YouTube",B=te.value(d,"$..shortBylineText..url")||te.value(d,"$..longBylineText..url")||"",P=te.value(d,"$..videoCountShortText..text")||te.value(d,"$..videoCountText..text")||te.value(d,"$..videoCountShortText..simpleText")||te.value(d,"$..videoCountText..simpleText")||te.value(d,"$..thumbnailText..text")||te.value(d,"$..thumbnailText..simpleText");p={type:"list",listId:g,url:ne.YT+"/playlist?list="+g,title:O.trim(),image:C,thumbnail:C,videoCount:P,author:{name:R,url:ne.YT+B}};break;case"channel":var M=le(te.value(d,"$..thumbnail..url"))||le(te.value(d,"$..thumbnails..url"))||le(te.value(d,"$..thumbnails")),k=te.value(d,"$..title..text")||te.value(d,"$..title..simpleText")||te.value(d,"$..displayName..text"),Y=te.value(d,"$..shortBylineText..text")||te.value(d,"$..longBylineText..text")||te.value(d,"$..displayName..text")||te.value(d,"$..displayName..simpleText"),U=te.value(d,"$..videoCountText..text")||te.value(d,"$..videoCountText..simpleText")||"0",L=te.value(d,"$..subscriberCountText..text")||te.value(d,"$..subscriberCountText..simpleText");"string"==typeof L&&(L=L.split(/\s+/).filter(function(e){return e.match(/\d/)})[0]);var V=te.value(d,"$..navigationEndpoint..url")||"/user/"+k;p={type:"channel",name:Y,url:ne.YT+V,title:k.trim(),image:M,thumbnail:M,videoCount:Number(U.replace(/\D+/g,"")),videoCountLabel:U,subCount:function(e){if(!e)return;var t=e.split(/\s+/).filter(function(e){return e.match(/\d/)})[0].toLowerCase(),i=t.match(/\d+(\.\d+)?/);if(!i||!i[0])return;var n=Number(i[0]);return 0<=t.indexOf("m")?1e6*n:0<=t.indexOf("k")?1e3*n:n}(L),subCountLabel:L};break;case"live":var A=le(te.value(d,"$..thumbnail..url"))||le(te.value(d,"$..thumbnails..url"))||le(te.value(d,"$..thumbnails")),z=te.value(d,"$..title..text")||te.value(d,"$..title..simpleText"),F=te.value(d,"$..shortBylineText..text")||te.value(d,"$..longBylineText..text"),G=te.value(d,"$..shortBylineText..url")||te.value(d,"$..longBylineText..url"),H=te.query(d,"$..viewCountText..text").join("")||te.query(d,"$..viewCountText..simpleText").join("")||"0",J=Number(H.split(/\s+/)[0].split(/[,.]/).join("").trim()),K=te.query(d,"$..description..text").join("")||te.query(d,"$..descriptionSnippet..text").join(""),W=te.value(d,"$..upcomingEventData..startTime"),X=Date.now()>W?1e3*W:W,Q=ae(X);p={type:"live",videoId:$,url:ne.YT+"/watch?v="+$,title:z.trim(),description:K,image:A,thumbnail:A,watching:Number(J),author:{name:F,url:ne.YT+G}},X?(p.startTime=X,p.startDate=Q,p.status="UPCOMING"):p.status="LIVE"}p&&o.push(p)}catch(e){ie(e),u.push(e)}}var Z=te.value(s,"$..continuation");return o._ctoken=Z,u.length?t(u.pop(),o):t(null,o)}function ae(e){return e=new Date(e),ie("fn: _toInternalDateString"),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()}function re(e){var t=e.split(/\s+/),i=t[t.length-1].replace(/[^:.\d]/g,"");if(!i)return{toString:function(){return t[0]},seconds:0,timestamp:0};for(;i[i.length-1].match(/\D/);)i=i.slice(0,-1);for(var n=(i=i.replace(/\./g,":")).split(/[:.]/),a=0,r=0,l=n.length-1;0<=l;l--)if(!(n[l].length<=0)){var u=n[l].replace(/\D/g,"");if(a+=parseInt(u)*(0<r?Math.pow(60,r):1),2<++r)break}return{toString:function(){return a+" seconds ("+i+")"},seconds:a,timestamp:i}}function le(e){var t;return"string"!=typeof e?e.length?le(t=e[0]):void 0:0===(t=(t=(t=(t=e).split("?")[0]).split("/default.jpg").join("/hqdefault.jpg")).split("/default.jpeg").join("/hqdefault.jpeg")).indexOf("//")?"https://"+t.slice(2):t.split("http://").join("https://")}function S(e){for(var t,i=/<.?script.?>((.|[\n\r])+?)<.?\/.?script.?>/g,n="";(t=i.exec(e))&&(n+=t[1]+"\n"),t;);return n}function j(e,t){var i=j.cache||{};(j.cache=i)[t]=i[t]||{};var n=i[t].lines||t.split("\n");i[t].lines=n,clearTimeout(i[t].timeout),i[t].timeout=setTimeout(function(){delete i[t]},100);for(var a=0;a<n.length;a++){var r=n[a];if(e.test(r))return r}return""}function _(e,t,i){var n=e.indexOf(t),a=e.lastIndexOf(i);return n<0||a<0?"":e.slice(n,a+1)}e.exports=a,e.exports.search=a,s.main===e&&(n="superman theme list pewdiepie channel",console.log("test: doing list search"),a({query:n,pageEnd:1},function(e,t){if(e)throw e;var i=t.videos,n=t.playlists,a=t.channels;console.log("videos: "+i.length),console.log("playlists: "+n.length),console.log("channels: "+a.length);for(var r=0;r<i.length;r++){var l=i[r],u=" (".concat(l.timestamp,")");console.log(l.title+u)}n.forEach(function(e){console.log("playlist: ".concat(e.title," | ").concat(e.listId))}),a.forEach(function(e){console.log("channel: ".concat(e.title," | ").concat(e.description))})}))},{"async.parallellimit":void 0,cheerio:void 0,dasu:void 0,fs:void 0,"human-time":void 0,jsonpath:void 0,path:void 0,querystring:void 0,url:void 0}]},{},[1])(1)});